<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>exp_assignment1: ontological-robot-control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">exp_assignment1
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">package for the experimental labratory course first assignment</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ontological-robot-control </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Introduction</h1>
<p>This package is an experiment to use a topogical map ontology for controling a robot in ROS through aRMOR service. The ontology consists of an indoor environment with multiple rooms and a mobile robot. You can get to know more about the detatils of the source code using the <a href="https://github.com/donyamostaghniyazdi/exp_assignment1">documentation</a> provided for this rospackage.</p>
<p>The robot start in the E location and waits until it receives the information to build the topological map, i.e., the relations between C1, C2, R1, R2, R3 locations and the doors D1...D6. The robot moves in a new location, and waits for some times before to visit another location. This behavior is repeated in a infinite loop.</p>
<p>When the robot battery is low, it goes in the E location, and wait for some times before to start again with the above behavior.</p>
<p>When robot battery is not low, it should move among locations with this policy:</p>
<ol type="1">
<li>It should mainly stay on corridors,</li>
<li>If a reachable room has not been visited for some times it should visit it.</li>
</ol>
<h1><a class="anchor" id="autotoc_md2"></a>
Software Architecture</h1>
<p>In order to simulate the movements of the robot and its stimulus, the approach presented in the <a href="https://github.com/buoncubi/arch_skeleton">arch_skeleton</a> example is used with some changes (e.g. planner and controller delay time, battery level).</p>
<p>Other main part of software architucture consists of finite state machine which is based on <a href="http://wiki.ros.org/smach">smach</a> for having a better overview of process states and transitions among them and <a href="https://github.com/EmaroLab/armor">aRMOR</a> for using the ontology of topogical map for controling the robot in ROS.</p>
<p>The software architucture is represented in the following figure.</p>
<p>The components of this software architucture can be described as follows:</p>
<h2><a class="anchor" id="autotoc_md3"></a>
robot-state</h2>
<p>The <code>robot-state</code> is a node that encodes the knowledge shared among the other components, and it implements two services for robot position (i.e., <code>state/set_pose</code> and <code>state/get_pose</code>) and two other for robot battery level (i.e., <code>state/set_battery_level</code> and <code>state/get_battery_level</code>)</p>
<h2><a class="anchor" id="autotoc_md4"></a>
motion planner</h2>
<p>The planner node implements an action server named <code>motion/planner</code>. This is done by the means of the <code>SimpleActionServer</code> class based on the <code>Plan</code> action message. This action server requires the <code>state/get_pose/</code> service of the <code>robot-state</code> node, and a <code>target</code> point given as goal.</p>
<p>Given the current and target points, this component returns a plan as a list of <code>via_points</code>, which only consist of the starting and ending points for simplicity. Morever the delay time for generating the path is considered to be small to prevent conflicts between robot real situation and finite state machine. When a new <code>via_points</code> is generated, the updated plan is provided as <code>feedback</code>. When all the <code>via_points</code> have been generated, the plan is provided as <code>results</code>.</p>
<p>There is also a <code><a class="el" href="namespaceplanner__client.html">planner_client</a></code> node, which gets the target point from <code><a class="el" href="namespacefinite__state__machine.html">finite_state_machine</a></code> node through <code>/target_point</code> topic and sends it to the planner server as action goal. When the result is found as it is described above, publishes it to the <code>/path</code> topic to be used by the <code><a class="el" href="namespacecontroller__client.html">controller_client</a></code> node.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
motion controller</h2>
<p>The <code>controller</code> node implements an action server named <code>motion/controller</code>. This is done by the means of the <code>SimpleActionServer</code> class based on the <code>Control</code> action message. This action server requires the <code>state/set_pose/</code> service of the <code>robot-state</code> node and a plan given as a list of <code>via_points</code> by the <code>planner</code>.</p>
<p>Given the plan and the current robot position, this component iterates for each planned <code>via_point</code> and waits to simulate the time spent moving the robot to that location. The waiting time is computed using the robot speed and the eucledian distance between the points. Each time a <code>via_point</code> is reached the <code>state/set_pose</code> service is invoked, and a <code>feedback</code> is provided. When the last <code>via_point</code> is reached, the action service provides a result by propagating the current robot position, which has been already updated through the <code>state/set_pose</code> service. Morever in each movement step, the robot battery level is read by the <code>controller</code> node using <code>state/get_battery_level</code> and after decreasing gets set through <code>state/set_battery_level</code>.</p>
<p>The provided <code><a class="el" href="namespacecontroller__client.html">controller_client</a></code> node, subscribes <code>/path</code> topic to get the <code>via_points</code> and then sends them to the <code>controller</code> server as an action goal.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
finite state machin - aRMOR</h2>
<p>Defines the states and transitions for the finite state machine of the topological map, it also uses <code><a class="el" href="topological__map_8py.html">topological_map.py</a></code> helper script to update the ontology while the process is running, and retreives the target room based on last visit times, finaly sends the target room pose to the <code><a class="el" href="namespaceplanner__client.html">planner_client</a></code> through <code>/target_point</code> in order to find the path.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
node graph</h2>
<p>The node graph is represented in the following figure.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Temporal Diagram (UML Sequence Diagram)</h2>
<p>The following figure represents the UML sequence diagram of this package. In the initial state, user launches the nodes, causing some of them to get some rosparams such as <code>environment_size</code> and <code>initial_pose</code>. Then, in each loop cycle, <code>armor_service</code> which is implemented inside <code><a class="el" href="namespacefinite__state__machine.html">finite_state_machine</a></code> node, gets the current robot pose from <code>robot-state</code> node and updates the ontology, then the target room will be sent to the <code><a class="el" href="namespaceplanner__client.html">planner_client</a></code> through <code>/target_point</code> topic and also the state of gets changed considering the target room. <code>Planner</code> tries to find the path and sends it to the <code><a class="el" href="namespaceplanner__client.html">planner_client</a></code> as <code>PlanResult</code>. Finally the <code><a class="el" href="namespacecontroller__client.html">controller_client</a></code> node subscribes the <code>/path</code> topic and sends it as <code>ControlGoal</code> to the <code>controller</code> node so that it can move the robot by setting the robot pose through <code>/state/set_pose</code> service and the cycles goes on again.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md10"></a>
Installation</h2>
<p>This package is based on <a href="https://github.com/EmaroLab/armor">aRMOR</a> it has to be installed as it is described in the provided link as a pre-condition for running this package.</p>
<p>It is also depended on <a href="http://wiki.ros.org/smach">smach</a>, it can be installed using the following commands:</p>
<div class="fragment"><div class="line">$ sudo apt-get install ros-&lt;distro&gt;-executive-smach*</div>
</div><!-- fragment --><div class="fragment"><div class="line">$ sudo apt-get install ros-&lt;distro&gt;-smach-viewer</div>
</div><!-- fragment --><p>Once the dependencies are met, the package can be installed as it follows:</p>
<div class="fragment"><div class="line">$ mkdir -p catkin_ws/src</div>
</div><!-- fragment --><div class="fragment"><div class="line">$catkin_create_pkg ontological_robot_control</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">```bashscript</div>
<div class="line">$ cd catkin_ws/src</div>
</div><!-- fragment --><div class="fragment"><div class="line">$ git clone https://github.com/donyamostaghniyazdi/exp_assignment1</div>
</div><!-- fragment --><div class="fragment"><div class="line">$ cd ..</div>
</div><!-- fragment --><div class="fragment"><div class="line">$ source /opt/ros/&lt;distro&gt;/setup.bash</div>
</div><!-- fragment --><div class="fragment"><div class="line">$ catkin_make</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md11"></a>
Running</h2>
<p>In order to initialize the software architucture along with the finite state machine representation, run the following command.</p>
<div class="fragment"><div class="line">$ source devel/setup.bash</div>
</div><!-- fragment --><div class="fragment"><div class="line">$ roslaunch ontological_robot_control topological_map.launch</div>
</div><!-- fragment --><p>Here is the result of launching this package:</p>
<p>The above gif shows the overview of launching this package, as it can be seen in the finite state machine the robot starts from room "E", and considering the initial last visit times defined in the ontology, the first target room is "R1". When it reaches the target room the next one is "R3" and the "R4" but before reaching "R4" the battery level gets below the threshold "7" and causes the robot to go first to room "E" and then "R4", and so on.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Working Hypothesis and Environment</h1>
<ol type="1">
<li>System's Features: The topological map is considered to be in size 10x10. Each time when a room is chosen as a target room from the ontology, the corresponding point will be sent to the planner as <code>PlanGoal</code></li>
</ol>
<ol type="1">
<li>System's Limitations: The planner is the main limitation in this rospackage, because it only considers the starting and target point. The battery level is also a limitation in the robot behaviour, causing it to select the charging room "E" over the target room resulted from the last visit times.</li>
<li>Possible Technical Improvements: The planner node could be improved in such a way that it considers the walls more precisely. The battery level could also implemented in a more realistic way.</li>
</ol>
<h1><a class="anchor" id="autotoc_md13"></a>
Authors and Contacts</h1>
<ul>
<li>Donya MostaghniYazdi</li>
<li>email: <a href="#" onclick="location.href='mai'+'lto:'+'don'+'ya'+'.mo'+'st'+'agh'+'ni'+'01@'+'gm'+'ail'+'.c'+'om'; return false;">donya<span style="display: none;">.nosp@m.</span>.mos<span style="display: none;">.nosp@m.</span>taghn<span style="display: none;">.nosp@m.</span>i01@<span style="display: none;">.nosp@m.</span>gmail<span style="display: none;">.nosp@m.</span>.com</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
